version: '3.8'

services:
  ## Frontend service builds the React application using Vite.  It exposes
  ## port 5173 for local development and hotâ€“reloading.  The working
  ## directory is mounted into the container so edits on the host are
  ## reflected immediately.  The `node_modules` folder is kept inside
  ## the container to avoid permission issues.
  client:
    build:
      context: ./client
      dockerfile: Dockerfile
    ports:
      - "5173:5173"
    # volumes:
    #   - ./client:/app
    #   - /app/node_modules
    command: npm run dev -- --host

  ## Backend service provides a simple Express API.  It watches the
  ## `server` folder for changes and restarts automatically when
  ## dependencies are installed.  The API listens on port 3001.
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    ports:
      - "3002:3001"
    # volumes:
    #   - ./server:/app
    #   - /app/node_modules
    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    command: npm start